#!/bin/sh

LISTFILE=$1
HOSTPORT=${2:-localhost:8000}
FIFO=${3:-/tmp/fnord}
export GABBI_FORCE_COLOR=True

function wait_one_key() {
    read -n 1 -s
}

wait_one_key
(for file in $(cat $LISTFILE); do
    clear
    clear >${FIFO}
    cat $file >${FIFO}
    (echo ; echo) >${FIFO}
    gabbi-run $HOSTPORT < $file |less -eR
done) 2>${FIFO}

clear
